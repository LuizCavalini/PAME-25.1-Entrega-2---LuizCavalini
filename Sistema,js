const Cliente = require('./Cliente.js');
const Funcionario = require('./Funcionario');
const Quartos = require('./Quartos.js');
const Reserva = require('./Reserva.js');

class Sistema{
    constructor(){
        this.clientes = [];
        this.funcionarios = [];
        this.quartos = [];
        this.reservas = [];
        this.usuarioLogado = null;
        this.proximoIdCliente = 1;
        this.proximoIdFuncionario = 1;
        this.proximoIdReserva = 1;
    }
    // Processos

    cadastroCliente(nome, dataNascimento, cpf, email, senha){
        const clienteExistente = this.clientes.find(c => c.cpf === cpf || c.email === email);
        if(clienteExistente){
            console.log("Erro: CPF ou E-mail já cadastrado.");
            return null; 
        }
        const novoCliente = new Cliente(this.proximoIdCliente, nome, dataNascimento, cpf, email, senha);

        this.clientes.push(novoCliente);

        this.proximoIdCliente++;

        console.log("Cadastro realizado com sucesso");
        return novoCliente;
    }

    login(email, senha){
        let usuario = this.funcionarios.find(f => f.email === email && c.senha === senha);
        if(usuario){
            this.usuarioLogado = usuario;
            return{tipo: 'funcionario', dados: usuario};
        }
        usuario = this.clientes.find(c => c.email === email && c.senha === senha);
        if(usuario){
            this.usuarioLogado = usuario;
            return{tipo: 'cliente', dados: usuario};
        }
        this.usuarioLogado = null;
        return null;
    }

    logout(){
        this.usuarioLogado = null;
        console.log("Logout realizado com sucesso.");
    }

    addQuarto(qtdCamas, precoPorNoite, qtdDisponivel, nome, descricao){
        if(!this.usuarioLogado || !(this.usuarioLogado instanceof Funcionario)){
            console.log("Acesso negado. Apenas funcionários podem adicionar quartos.");
            return;
        }

        const novoQuarto = new Quartos(qtdCamas, precoPorNoite, qtdDisponivel, nome, descricao);
        this.quartos.push(novoQuarto);
        console.log(`Quarto "${nome}" adicionado com sucesso!`);
    }

    verListaDeReservas(){
        return this.reservas;
    }

    verListaDeQuartos(){
        return this.quartos;
    }

    verListaDeClientes(){
        return this.clientes;
    }
}
module.exports = Sistema;

